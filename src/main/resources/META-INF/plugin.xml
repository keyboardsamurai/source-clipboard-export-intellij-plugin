<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.keyboardsamurais.plugin.source-clipboard-export-plugin</id>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Export Source to Clipboard</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="agudo.projects@icloud.com" url="https://www.antonioagudo.com">Antonio Agudo</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Simple HTML elements (text formatting, paragraphs, and lists) can be added inside of <![CDATA[ ]]> tag.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-description -->
    <description><![CDATA[<description>
    This plugin automates the inclusion of source code and its file path into your clipboard, streamlining the process
    for analysis and sharing, especially with Large Language Models (LLMs).

    Including the file path with the source code often gives immediate context to the recipient or the processing tool.
    This is particularly useful when sharing code snippets with team members or integrating with AI and LLMs,
    as it clarifies where the code comes from within a project's directory structure.
    It helps in understanding the purpose and scope of the code, especially in large projects with complex directory
    hierarchies and results in better LLM response accuracy and performance.

<ul>
    <li><b>üöÄ AI-Optimized Sharing:</b> Effortlessly prepare detailed, context-rich code snippets for immediate AI analysis.</li>
    <li><b>ü§ù Enhanced Collaboration:</b> Instantly share complete and accurate code context with team members and AI assistants.</li>
    <li><b>üìã Automated Efficiency:</b> Automatically attach file paths to clipboard content, eliminating manual errors and speeding up workflow.</li>
    <li><b>üìÇ Intelligent Directory Handling:</b> Quickly export entire directories into an AI-friendly format while smartly skipping irrelevant files like binaries and large files, optimizing your workflow.</li>
    <li><b>üî¢ Optimized Performance:</b> Efficiently manage large data exports with built-in file limit controls, maintaining optimal plugin performance.</li>
</ul>

    Export Source to Clipboard is designed for developers and teams looking to leverage AI in their coding process,
    offering a convenient bridge between your code and the latest AI technologies for analysis and improvement.
    It's an essential tool for anyone aiming to enhance productivity and focus on innovation in the software
    development lifecycle.
</description>
]]></description>

    <change-notes><![CDATA[
        <h3>Version 1.8 ‚Äì Enhanced User Experience üéØ</h3>
        <ul>
            <li><b>‚å®Ô∏è Keyboard Shortcuts:</b> Added convenient keyboard shortcuts for quick access:
                <ul>
                    <li><code>Ctrl+Shift+C</code> (Windows/Linux) or <code>Cmd+Shift+C</code> (Mac) - Export Files/Folders to Clipboard</li>
                    <li><code>Ctrl+Shift+Alt+C</code> (Windows/Linux) or <code>Cmd+Shift+Alt+C</code> (Mac) - Toggle Filters</li>
                </ul>
            </li>
            <li><b>üéØ Smarter Defaults:</b> Improved out-of-box experience with better default settings:
                <ul>
                    <li>Increased default file count limit from 50 to 200 files</li>
                    <li>Increased default file size limit from 100KB to 500KB</li>
                    <li>Line numbers now enabled by default for better AI/LLM context</li>
                    <li>Filters automatically disabled when filter list is empty</li>
                </ul>
            </li>
            <li><b>üñ•Ô∏è Quick Export Tool Window:</b> Optional visual export interface for power users:
                <ul>
                    <li>Interactive file tree with checkboxes for precise selection</li>
                    <li>Real-time preview of export content with token count and size estimation</li>
                    <li>Integrated toolbar with export, refresh, clear, and settings actions</li>
                    <li>Completely optional - can be enabled/disabled in settings or hidden from main UI</li>
                </ul>
            </li>
            <li><b>üß† Smart Export Actions:</b> Context-aware export options for streamlined workflows:
                <ul>
                    <li><b>Export with Tests:</b> Automatically includes related test files for your selection</li>
                    <li><b>Export with Configs:</b> Includes relevant configuration files (pom.xml, package.json, etc.)</li>
                    <li><b>Export Recent Changes:</b> Exports files modified in the last 24 hours</li>
                    <li><b>Export with Direct Imports:</b> Includes all directly imported files from the same project</li>
                    <li><b>Export with Transitive Imports:</b> Includes all direct and transitive dependencies</li>
                    <li>All accessible via right-click context menu under "Export Related Files"</li>
                </ul>
            </li>
            <li><b>üìù Export History:</b> Track and revisit your export workflow:
                <ul>
                    <li>Automatically maintains history of your last 10 exports</li>
                    <li>Stores timestamp, file count, size, token estimates, and file paths</li>
                    <li>Persistent across IDE sessions for workflow continuity</li>
                </ul>
            </li>
            <li><b>üîç Export Diff View:</b> Compare and understand changes between exports:
                <ul>
                    <li>Visual diff showing added/removed files compared to last export</li>
                    <li>Statistics comparison (file count, size, tokens) between exports</li>
                    <li>"Copy Diff" button for easy sharing of change summaries</li>
                    <li>"Export Changes Only" option to export just the newly added files</li>
                </ul>
            </li>
            <li><b>üìä Enhanced Notifications:</b> Copy notifications now show comprehensive information: file count, total size (KB/MB), and estimated token count</li>
            <li><b>üëÅÔ∏è Preview Export:</b> New "Preview Export" button in settings shows exactly what your export will look like with current settings</li>
            <li><b>‚ö° Performance Improvements:</b> Now uses system CPU count for parallel processing instead of fixed thread count</li>
            <li><b>‚ö†Ô∏è Large Operation Warning:</b> Shows confirmation dialog when exporting more than 100 files to prevent accidental large exports</li>
            <li><b>üí¨ Clearer Messages:</b> Improved error messages with specific guidance and actionable "Open Settings" buttons when limits are reached</li>
            <li><b>üè∑Ô∏è UI Enhancements:</b> Added tooltips to output format dropdown explaining each format, clearer action names, and dynamic filter state display</li>
        </ul>

        <h3>Version 1.7 ‚Äì Enhanced Stack Traces & Gitignore Magic ‚ú®</h3>
        <ul>
            <li><b>üìå Stack Trace Folding:</b> Introduced intelligent stack trace folding in console views. Library frames are neatly collapsed, highlighting your project code clearly:
                <ul>
                    <li>Special handling ensures critical contexts like Spring test frames remain fully visible.</li>
                    <li>Improved readability with consistent indentation for folded frames.</li>
                    <li>Quickly copy neatly folded stack traces directly from the IntelliJ console.</li>
                </ul>
            </li>
            <li><b>üßô Gitignore Mastery:</b> Significantly upgraded gitignore parsing with hierarchical rule handling, caching optimizations, and precise pattern matching. Enjoy accurate, git-consistent exclusions with enhanced logging for effortless debugging.</li>
            <li><b>üöÄ Accuracy Boosts:</b> Optimized token counting for GPT-4 accuracy using the powerful <a href="https://github.com/knuddelsgmbh/jtokkit">Jtokkit library</a>, significantly enhancing export speed and responsiveness.</li>
        </ul>

        <h3>Version 1.6 ‚Äì Powerful New Improvements</h3>
        <ul>
            <li><b>üìú Gitignore Integration:</b> Automatically respects your <code>.gitignore</code> settings, providing clean and relevant exports.</li>
            <li><b>üßÆ Token Count Insights:</b> Know exactly how much code you're exporting, helping you avoid LLM context overflow.</li>
            <li><b>üíª Enhanced Settings Interface:</b> Now easier than ever to customize export limits and exclusions, with intuitive validation and user-friendly feedback.</li>
        </ul>
    ]]></change-notes>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <!-- depends>com.intellij.modules.execution</depends -->
    <depends>com.intellij.java</depends>
    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <projectConfigurable instance="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.config.SourceClipboardExportConfigurable"
                             displayName="Export Source to Clipboard"
                             id="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.config.SourceClipboardExportConfigurable" />
        <notificationGroup id="SourceClipboardExport" displayType="BALLOON" />
        <toolWindow id="ExportSource" 
                    factoryClass="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.ui.ExportToolWindowFactory"
                    anchor="right"
                    canCloseContents="false"/>
    </extensions>

    <actions>
        <action id="SourceClipboardExport.DumpFolderContents"
                class="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.actions.DumpFolderContentsAction"
                text="Export Files/Folders to Clipboard"
                description="Export source code and file paths to clipboard">
            <add-to-group group-id="ProjectViewPopupMenu" />
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift C"/>
            <keyboard-shortcut keymap="Mac OS X" first-keystroke="meta shift C"/>
            <keyboard-shortcut keymap="Mac OS X 10.5+" first-keystroke="meta shift C"/>
        </action>
        <action id="SourceClipboardExport.ToggleFilters"
                class="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.actions.ToggleFiltersAction"
                text="Toggle Filters"
                description="Toggle file extension filters on/off">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after" relative-to-action="SourceClipboardExport.DumpFolderContents"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt C"/>
            <keyboard-shortcut keymap="Mac OS X" first-keystroke="meta shift alt C"/>
            <keyboard-shortcut keymap="Mac OS X 10.5+" first-keystroke="meta shift alt C"/>
        </action>
        
        <!-- Smart Export Group -->
        <group id="SourceClipboardExport.SmartExportGroup"
               class="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.actions.SmartExportGroup"
               text="Export Related Files"
               description="Smart export with related files">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after" relative-to-action="SourceClipboardExport.ToggleFilters"/>
        </group>
        
        <!-- Export Diff Action -->
        <action id="SourceClipboardExport.ExportDiff"
                class="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.actions.ExportDiffAction"
                text="Export Diff"
                description="Show differences from last export">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after" relative-to-action="SourceClipboardExport.SmartExportGroup"/>
        </action>

        <!-- New Action for Folding Stack Traces -->
        <action id="SourceClipboardExport.FoldAndCopyStackTrace"
                class="com.keyboardsamurais.intellij.plugin.sourceclipboardexport.actions.FoldAndCopyStackTraceAction"
                text="Copy Compact Stack Trace"
                description="Folds external library frames in the selected stack trace and copies a compact version to clipboard.">
            <add-to-group group-id="ConsoleEditorPopupMenu" anchor="last"/>
        </action>

    </actions>

</idea-plugin>
